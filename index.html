<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>DiveSweeper</title>
<style>
:root {
  --tile-size: 40px;
  --tile-hidden: url("assets/hidden.png");
  --tile-revealed: url("assets/revealed.png");
  --tile-flag: url("assets/flag.png");
  --tile-mine: url("assets/mine.png");

  --face-happy: url("assets/faces/happy.png");
  --face-pressed: url("assets/faces/pressed.png");
  --face-dead: url("assets/faces/dead.png");
  --face-cool: url("assets/faces/cool.png");
}

/* ===== GLOBAL ===== */
body {
  background: #008080;
  font-family: Tahoma, Verdana, sans-serif;
  padding: 24px;
  display: flex;
  justify-content: center;
}

/* WINDOW */
.window {
  background: #c0c0c0;
  border: 2px solid black;
  box-shadow: inset -2px -2px #808080, inset 2px 2px #ffffff;
  display: flex;
  flex-direction: column;
  align-items: center;
  width: max-content;
  margin: auto;
}

/* TITLE BAR */
.title-bar {
  width: 100%;
  background: linear-gradient(to right, #000080, #0000a0);
  color: white;
  padding: 6px 10px;
  font-weight: bold;
  box-sizing: border-box;
}

/* CONTENT */
.content { padding: 8px; display:flex; flex-direction:column; align-items:center; }

.top-panel {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: #c0c0c0;
  border: 2px solid #808080;
  box-shadow: inset 2px 2px #ffffff, inset -2px -2px #404040;
  padding: 6px;
  margin-bottom: 8px;
  width: 100%;
  max-width: calc(var(--tile-size) * 30 + 20px);
}

/* COUNTERS */
.counter {
  background: black;
  color: #ff2a2a;
  font-family: "MS Sans Serif","Fixedsys",monospace;
  font-size: 32px;
  line-height: 32px;
  padding: 4px 6px;
  width: 84px;
  text-align: right;
  image-rendering: pixelated;
  -webkit-font-smoothing: none;
  font-smooth: never;
  box-shadow: inset 2px 2px #400000;
}

/* PLAYER STATS DISPLAY */
#playerStats {
  margin-top: 6px;
  font-family: "MS Sans Serif","Fixedsys",monospace;
  font-size: 16px;
  color: white;
}

/* FACE */
.face {
  width: 44px;
  height: 44px;
  background-color: #c0c0c0;
  background-repeat: no-repeat;
  background-position: center;
  background-size: 32px 32px;
  border: 2px solid #808080;
  box-shadow: inset 2px 2px #ffffff, inset -2px -2px #404040;
  cursor: pointer;
}
.face:active { box-shadow: inset -2px -2px #ffffff, inset 2px 2px #404040; }

/* DIFFICULTY BUTTONS */
.difficulty { display: flex; flex-direction: column; gap: 6px; margin-bottom: 8px; align-items:center; }
.difficulty-top, .difficulty-bottom { display:flex; gap:6px; justify-content:center; }
.difficulty button { font-size:13px; padding:4px 10px; background:#c0c0c0; border:2px solid #808080; box-shadow: inset 2px 2px #ffffff, inset -2px -2px #404040; cursor:pointer; }
.difficulty button:active { box-shadow: inset -2px -2px #ffffff, inset 2px 2px #404040; }

/* BOARD */
#board { display:grid; border:3px solid #808080; box-shadow: inset 2px 2px #404040, inset -2px -2px #ffffff; margin-top:6px; }

/* TILES */
.tile {
  width: var(--tile-size);
  height: var(--tile-size);
  background-image: var(--tile-hidden);
  background-size: cover;
  image-rendering: pixelated;
  display: flex; align-items: center; justify-content: center;
  font-weight: bold; font-size: calc(var(--tile-size)*0.55);
  cursor:pointer; user-select:none;
}
.tile.revealed { background-image: var(--tile-revealed); }
.tile.pressed { box-shadow: inset 2px 2px #404040, inset -2px -2px #ffffff; background-color:#a0a0a0; }
.tile.flag { background-image: var(--tile-flag); }
.tile.revealed.mine { background-color:#c00000; background-image: var(--tile-mine); background-size:cover; }
.tile.n1 { color:#0000ff; } .tile.n2 { color:#008200; } .tile.n3 { color:#ff0000; }
.tile.n4 { color:#000084; } .tile.n5 { color:#840000; } .tile.n6 { color:#008284; }
.tile.n7 { color:#840084; } .tile.n8 { color:#000000; }

/* GAME OVER */
#gameover {
  position: fixed; top:50%; left:50%;
  transform: translate(-50%, -50%) scale(0);
  font-size:48px;
  font-family:"MS Sans Serif","Fixedsys",monospace;
  color:white;
  pointer-events:none; text-align:center;
  transition: transform 0.5s ease-out;
  z-index:9999;
}

/* CREDITS */
#creditsOverlay {
  position: fixed; top:0; left:0; width:100vw; height:100vh;
  background: rgba(0,0,0,0.9);
  display:none; flex-direction: column; justify-content:center; align-items:center;
  z-index:9999; color:white; font-family:"MS Sans Serif","Fixedsys",monospace;
  text-align:center; gap:16px;
}
#creditsOverlay a { color:#00ffff; text-decoration: underline; }
#creditsOverlay img { width:650px; height:auto; image-rendering: pixelated; }
#creditsOverlay button {
  margin-top: 20px; padding:6px 12px;
  font-family:"MS Sans Serif","Fixedsys",monospace;
  background:#c0c0c0; border:2px solid #808080;
  box-shadow: inset 2px 2px #ffffff, inset -2px -2px #404040;
  cursor:pointer;
}
#creditsOverlay button:active { box-shadow: inset -2px -2px #ffffff, inset 2px 2px #404040; }

/* LAP2 FULLSCREEN POPUP */
#lap2Popup {
  position: fixed; top:0; left:0; width:100vw; height:100vh;
  display:flex; align-items:center; justify-content:center;
  background: rgba(128,128,128,0.5); color:#000;
  font-family: Arial, sans-serif; font-size:24px;
  text-align:center; pointer-events:none;
  -webkit-text-stroke: 0.5px black;
  z-index:9998;
  display:none;
}
</style>
</head>
<body>

<div class="window">
  <div class="title-bar">DiveSweeper</div>
  <div class="content">
    <div class="top-panel">
      <div id="mineCounter" class="counter">000</div>
      <div id="face" class="face"></div>
      <div id="timeCounter" class="counter">000</div>
    </div>

    <div id="playerStats"></div>

    <div class="difficulty">
      <div class="difficulty-top">
        <button onclick="setDifficulty(9,9,10)">Easy</button>
        <button onclick="setDifficulty(16,16,40)">Medium</button>
        <button onclick="setDifficulty(30,16,99)">Hard</button>
        <button onclick="showCredits()">Credits</button>
        <button id="lap2Toggle" onclick="toggleLap2()">Lap 2: OFF</button>
      </div>
      <div class="difficulty-bottom">
        <button onclick="setDifficulty(3,3,1)">Super Duper Easy Baby</button>
      </div>
    </div>

    <div id="board"></div>
  </div>
</div>

<!-- GAME OVER -->
<div id="gameover">You died to... Mine</div>

<!-- CREDITS -->
<div id="creditsOverlay">
  <div style="font-size:24px; font-weight:bold;">[Made By]</div>
  <div style="font-size:20px;">cozy <br><a href="https://www.roblox.com/users/1109975917/profile/" target="_blank">Profile</a></div>

  <div style="font-size:24px; font-weight:bold; margin-top:16px;">[Game By]</div>
  <div style="font-size:20px;">dive team <br><a href="https://www.roblox.com/games/102464178326906/DIVE-v0-2a" target="_blank">Game</a></div>

  <div style="font-size:24px; font-weight:bold; margin-top:16px;">[Honorable Mentions]</div>
  <div style="font-size:20px;">
    i agree <br>
    <img src="assets/other/i agree.png" alt="i agree">
  </div>

  <button onclick="closeCredits()">Close</button>
</div>

<div id="lap2Popup"></div>

<audio id="music" loop></audio>

<script>
let WIDTH=9, HEIGHT=9, MINES=10;
let board, revealed, flagged;
let gameOver, firstClick;
let timer=null, seconds=0;
let lap2Enabled=false, lap2Active=false;

let playerStats = { name:"Player", deaths:0, lastDeath:null };

const face=document.getElementById("face");
const music=document.getElementById("music");
const gameoverDiv=document.getElementById("gameover");
const creditsOverlay=document.getElementById("creditsOverlay");
const lap2Popup=document.getElementById("lap2Popup");
const playerStatsDiv=document.getElementById("playerStats");

window.onload = () => {
    const stored = localStorage.getItem("divePlayerName");
    playerStats.name = stored || prompt("Enter your name:", "Player") || "Player";
    localStorage.setItem("divePlayerName", playerStats.name);

    const savedStats = JSON.parse(localStorage.getItem("divePlayerStats"));
    if(savedStats) playerStats = savedStats;

    updatePlayerStats();
    init();
};

function updatePlayerStats(){
    playerStatsDiv.textContent = `Player: ${playerStats.name} | Deaths: ${playerStats.deaths} | Last Death: ${playerStats.lastDeath||"None"}`;
}

function playMusic(state){
  switch(state){
    case "before": music.src="assets/sfx/beforestart.mp3"; break;
    case "ingame": music.src="assets/sfx/ingame.mp3"; break;
    case "after": music.src="assets/sfx/aftergame.mp3"; break;
    case "lap2": music.src="assets/sfx/lap2.mp3"; break;
  }
  music.play();
}

face.onclick=()=>init();
function setFace(type){ face.style.backgroundImage = `var(--face-${type})`; }

function setDifficulty(w,h,m){ WIDTH=w; HEIGHT=h; MINES=m; lap2Active=false; init(); }

function showCredits(){ creditsOverlay.style.display="flex"; }
function closeCredits(){ creditsOverlay.style.display="none"; }

function toggleLap2(){
  lap2Enabled = !lap2Enabled;
  document.getElementById("lap2Toggle").textContent = lap2Enabled ? "Lap 2: ON" : "Lap 2: OFF";
}

function init(){
  board = Array(WIDTH*HEIGHT).fill(0);
  revealed = Array(WIDTH*HEIGHT).fill(false);
  flagged = Array(WIDTH*HEIGHT).fill(false);
  gameOver=false;
  firstClick=true;
  if(!lap2Active) { seconds=0; clearInterval(timer); timer=null; }
  setFace("happy");
  updateCounters();
  draw();
  playMusic("before");
  gameoverDiv.style.display="none";
}

function updateCounters(){
  document.getElementById("mineCounter").textContent =
    String(MINES-flagged.filter(f=>f).length).padStart(3,"0");
  document.getElementById("timeCounter").textContent =
    String(seconds).padStart(3,"0");
}

function startTimer(){ if(timer) return; timer=setInterval(()=>{ seconds++; updateCounters(); },1000); }

function placeMines(safe){
  let placed=0;
  while(placed<MINES){
    const i=Math.floor(Math.random()*board.length);
    if(board[i]===0 && i!==safe){ board[i]=-1; placed++; }
  }
  board.forEach((_,i)=>{
    if(board[i]!==-1) board[i]=neighbors(i).filter(n=>board[n]===-1).length;
  });
}
function neighbors(i){
  const x=i%WIDTH, y=Math.floor(i/WIDTH), n=[];
  for(let dy=-1;dy<=1;dy++)
    for(let dx=-1;dx<=1;dx++){
      if(!dx&&!dy) continue;
      const nx=x+dx, ny=y+dy;
      if(nx>=0&&ny>=0&&nx<WIDTH&&ny<HEIGHT) n.push(ny*WIDTH+nx);
    }
  return n;
}

function draw(){
  const b=document.getElementById("board");
  b.style.gridTemplateColumns=`repeat(${WIDTH}, var(--tile-size))`;
  b.innerHTML="";
  board.forEach((_,i)=>{
    const t=document.createElement("div");
    t.className="tile";
    if(revealed[i]){
      t.classList.add("revealed");
      if(board[i]===-1) t.classList.add("mine");
      else if(board[i]>0){ t.textContent=board[i]; t.classList.add("n"+board[i]); }
    }
    if(flagged[i] && !revealed[i]) t.classList.add("flag");

    t.onmousedown=()=>{ if(!gameOver&&!revealed[i]){ t.classList.add("pressed"); setFace("pressed"); } };
    t.onmouseup=()=>{ if(!gameOver&&!revealed[i]){ t.classList.remove("pressed"); setFace("happy"); } };
    t.onmouseleave=()=>{ if(!gameOver&&!revealed[i]){ t.classList.remove("pressed"); setFace("happy"); } };

    t.onclick=()=>reveal(i);
    t.oncontextmenu=e=>{ e.preventDefault(); if(!revealed[i]&&!gameOver&&!firstClick){ flagged[i]=!flagged[i]; updateCounters(); draw(); } };

    b.appendChild(t);
  });
}

function reveal(i){
  if(revealed[i]||flagged[i]||gameOver) return;

  if(firstClick){
    placeMines(i);
    startTimer();
    firstClick=false;
    if(!lap2Active) playMusic("ingame");
  }

  revealed[i]=true;

  if(board[i]===-1){
    gameOver=true;
    clearInterval(timer);
    setFace("dead");
    board.forEach((v,j)=>v===-1&&(revealed[j]=true));
    playMusic("after");
    lap2Active=false;

    playerStats.deaths++;
    playerStats.lastDeath="Mine";
    localStorage.setItem("divePlayerStats", JSON.stringify(playerStats));
    updatePlayerStats();

    const overlay=document.createElement("div");
    overlay.style.position="fixed"; overlay.style.top=0; overlay.style.left=0;
    overlay.style.width="100vw"; overlay.style.height="100vh";
    overlay.style.backgroundColor="black";
    overlay.style.display="flex";
    overlay.style.alignItems="center"; overlay.style.justifyContent="center";
    overlay.style.zIndex=9999;

    const msg=document.createElement("div");
    msg.textContent="You died to... Mine";
    msg.style.color="white";
    msg.style.fontFamily='"MS Sans Serif","Fixedsys",monospace';
    msg.style.fontSize="48px";
    msg.style.transform="scale(0)";
    msg.style.transition="transform 0.5s ease-out";
    overlay.appendChild(msg);
    document.body.appendChild(overlay);

    requestAnimationFrame(()=>{ requestAnimationFrame(()=>{ msg.style.transform="scale(1)"; }); });
    setTimeout(()=>{ overlay.remove(); },3000);
  }

  if(board[i]===0) neighbors(i).forEach(reveal);

  if(!gameOver && board.every((v,i)=>v===-1||revealed[i])){
    gameOver=true;
    clearInterval(timer);
    setFace("cool");
    playMusic("after");

    if(lap2Enabled && !lap2Active){
      lap2Active=true;
      showLap2Popup();
      setTimeout(()=>{ init(); playMusic("lap2"); }, 500);
      return;
    }
  }

  draw();
}

function showLap2Popup(){
  lap2Popup.textContent = `${playerStats.name} has completed the minefield, 1 more lap(s) to go!`;
  lap2Popup.style.display="flex";
  setTimeout(()=>{ lap2Popup.style.display="none"; },4000);
}
</script>

</body>
</html>
